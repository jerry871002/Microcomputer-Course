	ORG		0000H
	JMP		MAIN
	ORG		0050H
MAIN:
	MOV		TMOD,#0		；設定TIMER0,MODE0
;===KEYBOARD====================================
ROW1:
	MOV		R4,#1
	MOV		P1,#7FH
	CALL	DELAY
	MOV		A,P1
	ANL		A,#0FH
	MOV		R4,#0
	CJNE	A,#0FH,COL1
ROW2:
	MOV		P1,#BFH
	CALL	DELAY
	MOV		A,P1
	ANL		A,#0FH
	MOV		R4,#12
	CJNE	A,#0FH,COL1
ROW3:
	MOV		P1,#DFH
	CALL	DELAY
	MOV		A,P1
	ANL		A,#0FH
	MOV		R4,#24
	CJNE	A,#0FH,COL1

COL1:
	CJNE	A,#0EH,COL2
	MOV		R5,#0
	JMP		START
COL2:
	CJNE	A,#0DH,COL3
	MOV		R5,#3
	JMP		START
COL3:
	CJNE	A,#0BH,COL4
	MOV		R5,#6
	JMP		START
COL4:
	CJNE	A,#07H,ROW1
	MOV		R5,#9

;===SPEAKER===============================
START:	
	CJNE	R4,#1,NEW
	JMP		OLD
NEW:
	MOV		DPTR,#SCALE
	
	MOV		A,R4			；從SCALE 取得音調資料1
	ADD		A,R5
	MOV		TIME,A
	MOVC	A,@A+DPTR
	MOV		TONE1,A
	INC		TIME
	
	MOV		A,TIME			；從SCALE 取得音調資料2
	MOVC	A,@A+DPTR
	MOV		TONE2,A
	
	INC		TIME
	MOV		A,TIME
	MOVC	A,@A+DPTR		；從SCALE 取得拍子資料
	MOV		TEMPO,A

	MOV		TH0,TONE1
	MOV		TL0,TONE2 
	CALL	SOUND

	JMP		ROW1
OLD:
	JMP		ROW1
	
SOUND:
	MOV		TIME,#4			；GENERATE 2 CYCLES
SOUND1:
	SETB	SPEAKER
	CALL	SDELAY
	CLR		SPEAKER
	CALL	SDELAY
	DJNZ	TIME,SOUND1
	DJNZ	TEMPO,SOUND
	RET
DELAY:
	MOV		R6,#100
DELAY1:
	MOV		R7,#150
DELAY2:
	DJNZ	R7,DELAY2
	DJNZ	R6,DELAY1
	RET

SDELAY:
	SETB	TR0
	JNB		TF0,$
	CLR		TF0
	CLR		TF0
	MOV		TL0,TONE2		；餘
	MOV		TH0,TONE1		；商
	RET
SCALE:
	DB		196,20,66
	DB		202,28,73
	DB		209,4,83
	DB		211,5,87
	DB		216,5,98
	DB		220,17,110
	DB		224,14,124
	DB		226,0,131
	DB		229,8,147
	DB		232,10,165
	DB		233,20,175
	DB		236,3,196
